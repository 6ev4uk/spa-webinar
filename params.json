{"name":"Spa-webinar","tagline":" Разработка SPA на React, NodeJS, Express и MongoDB","body":"# Вебинар \"Разработка SPA на React, NodeJS, Express и MongoDB\"\r\n\r\n### План вебинара\r\n\r\n - Краткое введение в NodeJS и npm\r\n - Написание простого сервера на NodeJS\r\n - Кратко о MongoDB, взаимодействие с базой данных\r\n - Написание компонентов на ReactJS\r\n - Кратко об архитектуре Flux\r\n - Получение и обработка данных с API\r\n - Распределение данных внутри приложения\r\n - Динамика в приложении\r\n\r\n### Вспомогательные материлы\r\n\r\nВ рамках данного вебинара мы напишем небольшое приложение для создания и хранения заметок ([такое](ccылка)) на NodeJS, Express, MongoDB и React.\r\n\r\n#### 1. Введение в Node.js и npm\r\n\r\nNode.js - программная платформа, основанная на движке Javascript V8. Она позволяет выполнять Javascript код на сервере.\r\n\r\nПервое, что нужно сделать - это установить Node.js. Вместе с ним в комплекте идет также и npm (Node Package Manager) - менеджер пакетов. В зависимости от используемой операционной системы, у Вас естьтакие варианты:\r\n\r\n - Для Windows: [скачать .msi установщик](https://nodejs.org/en/download)\r\n - Для Linux: запустить ```curl -L https://npmjs.org/install.sh | sh``` в терминале\r\n - Для Mac: [скачать .pkg установщик](https://nodejs.org/en/download) или ```brew install node```, если используете [Homebrew](http://brew.sh/)\r\n\r\nПосле установки, можно проверить наличие Node.js и npm на Вашем компьютере.\r\n\r\n```\r\nnode -v\r\nv5.1.0\r\n\r\nnpm -v\r\n3.3.12\r\n```\r\n\r\n#### 2. Hello world на Node.js\r\n\r\nДавайте приступим к делу и напишем наше первое Node.js приложение «Hello world».\r\n\r\nОткройте любой редактор и создайте файл под названием helloworld.js. В нем мы хотим вывести строку «Hello world» в консоль, для этого пишем следующий код:\r\n\r\n```\r\nconsole.log(\"Hello World\");\r\n```\r\n\r\nСохраняем файл и выполняем его посредством Node.js из терминала:\r\n\r\n```\r\nnode helloworld.js\r\n```\r\n\r\nЭта команда должна вывести Hello World в вашем терминале.\r\n\r\n#### 3. Постановка задачи\r\n\r\nМы будем создавать приложения для работы с заметками с таким функционалом:\r\n\r\n    1. Добавить заметку\r\n    2. Просмотреть заметки\r\n    3. Удалить заметку\r\n\r\nВ самом начале, нам нужно спроектировать API сервера. Исходя из определенного выше функционала и опираясь на методолгию REST, нам понадобятся такие вызовы:\r\n\r\n    `GET /notes` - получить все заметки\r\n    `POST /notes` - создать новую заметку\r\n    `DELETE /notes/:id` - удалить заметку\r\n\r\n#### 4. Использование Express\r\n\r\n[Express](http://expressjs.com/) - это минималистичный и гибкий веб-фреймворк для приложений Node.js, предоставляющий обширный набор функций. Он значительно упрощает маршрутизацию, использование промежуточных обработчиков (middleware), обработку запросов и отладку.\r\n\r\nСоздадим новую папку для проекта. Добавим в нее файл `package.json` приблизительно такого содержания:\r\n\r\n```\r\n{\r\n  \"name\": \"NotesApp\",\r\n  \"version\": \"0.0.1\",\r\n  \"description\": \"Notes application\",\r\n  \"scripts\": {\r\n    \"server\": \"babel-node server/app.js\",\r\n  },\r\n  \"author\": {\r\n    \"name\": \"Kateryna Porshnieva\",\r\n    \"email\": \"k.porshnieva@gmail.com\",\r\n    \"url\": \"https://github.com/krambertech\"\r\n  },\r\n  \"dependencies\": {\r\n    \"body-parser\": \"*\",\r\n    \"cors\": \"*\",\r\n    \"express\": \"*\",\r\n    \"mongoose\": \"*\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"babel\": \"5.x\",\r\n    \"babel-loader\": \"5.x\"\r\n  }\r\n}\r\n\r\n```\r\n\r\nСоздадим папку `/server` - в ней будет храниться весь код, относящийся к серверной части приложения (бекенд). В ней создадим файл `app.js` - главный файл нашего сервера.\r\n\r\n**Примечание:** Весь последующий код будет написан в стандарте ES2015 (ES6).\r\n\r\n```\r\nimport express from 'express';\r\n\r\nconst app = express();\r\n\r\nconst server = app.listen(8080, () => {\r\n    console.log(`Server is up and running on port 8080`);\r\n});\r\n```\r\n\r\nЗдесь мы создали express-приложение и запустили веб-сервер на порте 8080. Для того, чтобы запустить его нужно выполнить в терминале `babel-node server/app.js`.\r\n\r\nПока что наш сервер ничего не умеет делать, давайте создадим для него новый маршрут:\r\n\r\n```\r\nimport express from 'express';\r\n\r\nconst app = express();\r\n\r\napp.get('/', (req, res) => {\r\n    res.send('Hello World!');\r\n});\r\n\r\nconst server = app.listen(8080, () => {\r\n    console.log(`Server is up and running on port 8080`);\r\n});\r\n```\r\n\r\nТеперь если открыть http://localhost:8080/ то вы увидите надпись \"Hello world\". Маршруты в Express описываются очень просто:\r\n\r\n```\r\napp.get('/grapes', (req, res) => {});\r\napp.post('/grapes', (req, res) => {});\r\napp.put('/grapes', (req, res) => {});\r\napp.delete('/grapes', (req, res) => {});\r\n```\r\n\r\nВы пишете `app.метод(маршрут, функция)`. Маршрут затем будет трансформирован в резулярное выражение, чтобы сервер понимал какие запросы как нужно обработать. Функция принимает объекты req ([объект запроса](http://expressjs.com/ru/4x/api.html#req)), res ([объект ответа](http://expressjs.com/ru/4x/api.html#res)) и next (функцию для вызова следующего обработчика).\r\n\r\n#### 5. MongoDB и mongoose\r\n\r\nMongoDB - это документо-ориентированная СУБД. Данные в MongoDB хранятся в документах, которые объединяются в коллекции. Каждый документ представляет собой JSON-подобную структуру (BSON). Проведя аналогию с реляционными СУБД, можно сказать, что коллекциям соответствуют таблицы, а документам — строки в таблицах. В отличие от РСУБД MongoDB не требует какого-либо описания схемы базы данных — она может постепенно меняться по мере развития приложения, что есть удобно.\r\n\r\nCначала нужно установить MongoDB на свой компьютер. Cсылка для скачивания и инструкции по установке: https://www.mongodb.org/downloads\r\n\r\nMongoose — самый популярный модуль для работы с mongodb на javascript. Он позволяет очень удобно работать с базой данных, в нем все строится на схемах данных. То есть вы создаете модель хранимых данных в базе, а он уже помогает их типизировать, валидировать, строить бизнес логику поверх них, создавать запросы и т.д.\r\n\r\nВ базе данных мы будем хранить заметки. Так как в mongoose все строится на моделях данных, нам нужно создать модель (схему) для заметок. Делается это очень просто:\r\n\r\n```\r\nimport mongoose from \"mongoose\";\r\n\r\nconst Schema = mongoose.Schema;\r\n\r\nconst NoteSchema = new Schema({\r\n    title     : { type: String },\r\n    text      : { type: String, required: true },\r\n    color     : { type: String },\r\n    createdAt : { type: Date }\r\n});\r\n\r\nconst Note = mongoose.model('Note', NoteSchema);\r\n```\r\n\r\nЕсть огромное множество встроенных типов и приемов для работы с данными - все их вы можете найти в документации - http://mongoosejs.com/docs/\r\n\r\nСейчас мы создали схему для заметки, а потом, на основе этой схемы, модель. Модель - это класс, с помощью которого будут строиться документы в коллекции. В этом случае, каждый документ будет заметкой с параметрами и поведением, которое мы определили. Например, у каждой заметки есть заголовок, текст, цвет и дата создания. Из всех полей, только тект является обязательным - он помечен `required`.\r\n\r\nТакже к схемам можно добавлять методы:\r\n\r\n```\r\nvar mongoose = require('mongoose');\r\nmongoose.connect('mongodb://localhost/kittens');\r\n\r\nvar kittySchema = mongoose.Schema({\r\n    name: String\r\n});\r\n\r\nkittySchema.methods.speak = function () {\r\n  var greeting = this.name\r\n    ? \"Meow name is \" + this.name\r\n    : \"I don't have a name\";\r\n  console.log(greeting);\r\n}\r\n\r\nvar Kitten = mongoose.model('Kitten', kittySchema);\r\n\r\nvar fluffy = new Kitten({ name: 'fluffy' });\r\n\r\nfluffy.speak();\r\n```\r\n\r\nМы с вами создали говорящих котят. Для того, чтобы сохранить Флаффи в базу данных, нам нужно просто написать:\r\n\r\n```\r\nfluffy.save(function (err, fluffy) {\r\n  if (err) return console.error(err);\r\n  fluffy.speak();\r\n});\r\n```\r\n\r\nТеперь для того, чтобы получить всех котят, мы можем использовать метод find:\r\n\r\n```\r\nKitten.find(function (err, kittens) {\r\n  if (err) return console.error(err);\r\n  console.log(kittens);\r\n})\r\n```\r\n\r\nЧтобы найти всех котят по имени fluffy:\r\n\r\n```\r\nKitten.find({ name: \"fluffy\" }, callback);\r\n```\r\n\r\nТеперь давайте отойдем от котят и вернемся к нашим заметкам. Сохраним модель заметки в папке `/server/models/Note.js`. Теперь нужно связать взаимодействие с базой данных и запросы. Для работы с базой мы создадим утилиту `server/utils/DataBaseUtils.js`, в которой просто изолируем методы для работы с базой.\r\n\r\nСначала нам нужно настроить соединение:\r\n\r\n```\r\nimport mongoose from \"mongoose\";\r\n\r\nimport '../models/Note';\r\n\r\nconst Note = mongoose.model('Note');\r\n\r\nexport function setUpConnection() {\r\n    mongoose.connect(`mongodb://localhost/notes`);\r\n}\r\n```\r\n\r\nИ добавим несколько методов для взаимодействия с базой:\r\n\r\n```\r\nexport function listNotes(id) {\r\n    return Note.find();\r\n}\r\n\r\nexport function createNote(data) {\r\n    const note = new Note({\r\n        title: data.title,\r\n        text: data.text,\r\n        color: data.color,\r\n        createdAt: new Date()\r\n    });\r\n\r\n    return note.save();\r\n}\r\n\r\nexport function deleteNote(id) {\r\n    return Note.findById(id).remove();\r\n}\r\n```\r\n\r\nТеперь нужно создать соответствующие маршруты. Вернемся к файлу `/server/app.js`.\r\n\r\nДанные мы будем получать в формате json, для того, чтобы удобно с ними взаимодействовать мы будем использовать промежуточный обработчик [body-parser](https://github.com/expressjs/body-parser). Он будет вызван всякий раз, когда прийдет запрос - он сначала преобразует данные, а затем передаст управление нашим обработчикам.\r\n\r\nИспользуется он таким образом:\r\n\r\n```\r\nimport bodyParser from 'body-parser';\r\n\r\n// ...\r\n\r\napp.use( bodyParser.json() );\r\n```\r\n\r\nТеперь данные, полученые в json формате будут обработаны корректно.\r\n\r\nВ итоге, наш файл `app.js` выглядит вот так:\r\n\r\n```\r\nimport express from 'express';\r\nimport bodyParser from 'body-parser';\r\n\r\nimport * as db from './utils/DataBaseUtils';\r\n\r\n// Initialization of express application\r\nconst app = express();\r\n\r\n// Set up connection of database\r\ndb.setUpConnection();\r\n\r\n// Using bodyParser middleware\r\napp.use( bodyParser.json() );\r\n\r\n// RESTful api handlers\r\napp.get('/notes', (req, res) => {\r\n    db.listNotes().then(data => res.send(data));\r\n});\r\n\r\napp.post('/notes', (req, res) => {\r\n    db.createNote(req.body).then(data => res.send(data));\r\n});\r\n\r\napp.delete('/notes/:id', (req, res) => {\r\n    db.deleteNote(req.params.id).then(data => res.send(data));\r\n});\r\n\r\nconst server = app.listen(8080, function() {\r\n    console.log(`Server is up and running on port 8080`);\r\n```\r\n\r\nПосле обращения к базе мы используем промисы (Promise), они предоставляют удобный способ организации асинхронного кода.\r\n\r\nНа этом почти все, мы создали серверное приложение на node.js. Еще было бы неплохо создать для него конфигурацию, то есть вынести некоторые переменные в конфиг. Создадим файл `/etc/config.json`:\r\n\r\n```\r\n{\r\n    \"apiPrefix\": \"http://localhost:8080\",\r\n    \"serverPort\": \"8080\",\r\n    \"db\":{\r\n        \"name\": \"notes\",\r\n        \"host\": \"localhost\",\r\n        \"port\": 27017\r\n    }\r\n}\r\n```\r\n\r\nТеперь при использовании этих переменных, будем обращаться к этому файлу.\r\n\r\n**app.js**\r\n```\r\nimport express from 'express';\r\nimport cors from 'cors';\r\nimport bodyParser from 'body-parser';\r\n\r\nimport { serverPort } from '../etc/config.json';\r\n\r\nimport * as db from './utils/DataBaseUtils';\r\n\r\n// Initialization of express application\r\nconst app = express();\r\n\r\n// Set up connection of database\r\ndb.setUpConnection();\r\n\r\n// Using bodyParser middleware\r\napp.use( bodyParser.json() );\r\n\r\n// Allow requests from any origin\r\napp.use(cors({ origin: '*' }));\r\n\r\n// RESTful api handlers\r\napp.get('/notes', (req, res) => {\r\n    db.listNotes().then(data => res.send(data));\r\n});\r\n\r\napp.post('/notes', (req, res) => {\r\n    db.createNote(req.body).then(data => res.send(data));\r\n});\r\n\r\napp.delete('/notes/:id', (req, res) => {\r\n    db.deleteNote(req.params.id).then(data => res.send(data));\r\n});\r\n\r\nconst server = app.listen(serverPort, function() {\r\n    console.log(`Server is up and running on port ${serverPort}`);\r\n});\r\n```\r\n\r\n**DataBaseUtils.js**\r\n```\r\nimport mongoose from \"mongoose\";\r\n\r\nimport config from '../../etc/config.json';\r\n\r\nimport '../models/Note';\r\n\r\nconst Note = mongoose.model('Note');\r\n\r\nexport function setUpConnection() {\r\n    mongoose.connect(`mongodb://${config.db.host}:${config.db.port}/${config.db.name}`);\r\n}\r\n\r\nexport function listNotes(id) {\r\n    return Note.find();\r\n}\r\n\r\nexport function createNote(data) {\r\n    const note = new Note({\r\n        title: data.title,\r\n        text: data.text,\r\n        color: data.color,\r\n        createdAt: new Date()\r\n    });\r\n\r\n    return note.save();\r\n}\r\n\r\nexport function deleteNote(id) {\r\n    return Note.findById(id).remove();\r\n}\r\n```\r\n\r\n#### 6. Введение в React\r\n\r\nReactJS - это JаvaScript библиотека для построения пользовательских интерфейсов. Это не MVC фреймворк. К нему можно применить только V из этой аббревиатуры. Такая узкая сфера применения дает свободу использования React в различных системах в комбинации с другими библиотеками.\r\n\r\nReact был представлен Facebook в 2013 году, и очень быстро обрел популярность. Сегодня его используют многие известные компании включая Instagram, Airbnb, Ebay, Netflix, Yahoo и другие.\r\n\r\nОсновным отличием React от других JavaScript фреймворков является то, как он управляет состоянием приложения. Если вспомнить, как пользователи взаимодействовали с веб-страницами еще 10-15 лет назад, то увидим такую картину:\r\n\r\n![](https://github.com/krambertech/react-essential-course/raw/master/01-introduction-to-react/images/001.png)\r\n\r\nСервер всегда возвращал статическую страницу, и реакцией на действия пользователя была полная перезагрузка страницы. Преимуществами такого подхода, была простота в реализации и понимании, недостатками - скорость работы, отзывчивость, UX и потеря состояния при каждой перезагрузке.\r\n\r\nВсе очень изменилось с появлением AJAX, это подход к построению интерактивных веб-приложений, заключающийся в «фоновом» обмене данными браузера с веб-сервером. То есть, в фоновом режиме отправляются запросы на сервер, приходят с него ответы, изменяется состояние приложения и, соответственно, внешний вид. Именно такой подход породил понятие Single Page Application.\r\n\r\n![](https://github.com/krambertech/react-essential-course/raw/master/01-introduction-to-react/images/002.png)\r\n\r\nНо каждое визуальное изменение на странице соответствует изменению ее DOM дерева. Не секрет, что все манипуляции с DOM деревом являются очень ресурсоемкими операциями, т.к. изначально DOM дерево было статическим и никакой динамики не предусматривало.\r\n\r\n![](https://github.com/krambertech/react-essential-course/raw/master/01-introduction-to-react/images/006.png)\r\n\r\nИменно поэтому в React используется виртуальный DOM. Это такая легковесная копия реального DOM дерева на Javascript. Таким образом, React манипулирует не с реальным (синоним - медленным) DOM деревом, а с виртуальным.\r\n\r\n![](https://github.com/krambertech/react-essential-course/raw/master/01-introduction-to-react/images/003.png)\r\n\r\nОн сравнивает предыдущее состояние виртуального DOM дерева с его следующим состоянием и находит минимальное количество манипуляций, которые можно произвести уже с реальным DOM, чтобы обновить вид приложения согласно его новому состоянию.\r\n\r\n![](https://github.com/krambertech/react-essential-course/raw/master/01-introduction-to-react/images/004.png)\r\n\r\nИ это действительно быстро работает. А все что вам нужно делать - это просто менять состояние вашего приложения, а все остальное React сделает уже за вас!\r\n\r\n\r\n### Запуск проекта\r\n\r\n1. Clone this repo\r\n2. `cd spa-webinar`\r\n3. `npm install`\r\n4. Скопируйте `etc/config.js.sample` в `etc/config.js`\r\n4. `npm run server`\r\n5. `npm run webpack-devserver`\r\n6. Откройте http://localhost:8090 в браузере\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}